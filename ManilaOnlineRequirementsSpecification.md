# ManilaOnline软件需求说明书
#### 开发者：郭浩、金恬、姚照原、张溶倩、戴琪

## 1	引言
#### 1.1 编写目的
本文旨在对“桌游马尼拉的PC端实现”项目的需求进行详细的分解分析和阐述，明确后续系统开发所要解决的问题和工作方向，并作为项目评价和验收的依据之一。本文可供2018年“软件工程原理”课程的教师、选课同学及未来系统用户参阅。
#### 1.2背景 
说明： 
    a．待开发的软件系统的名称：桌游马尼拉的PC端实现。
    b．任务提出者：“软件工程原理”课程教师黄舟
开发者：软工第二小组成员（郭浩、金恬、戴琪、姚照原、张溶倩）
用户：软工课程教师、选课同学及其他可能的游戏玩家
运行网络；广域网环境

## 2	任务概述 
#### 2.1 目标 
该软件为一款独立的软件，将桌游马尼拉在PC端实现，遵循桌游本身的整体流程和规则，配以美观友好的界面。此外，玩家可以通过选择单人、多人模式分别获得人机对战、多人网络对战的游戏体验。
#### 2.2 用户的特点 
预期用户的特点：要求用户有基本计算机键盘、鼠标操作能力和游戏规则理解能力即可。
维护人员的特点：由北京大学地空学院地理信息科学专业本科生维护，具有一定计算机编程能力。
软件的预期使用频度：非日常软件，或在周末、节假日时段使用频率会稍有升高。 
#### 2.3 假定和约束
开发期限：在2018年秋季学期期末前结束所有开发及测试工作。
经费限制：目前无开发经费预算。

## 3	需求规定 
#### 3.1 对功能的规定
本软件拟定面向过程开发，我们将用实体-关系图、数据流图、流程图等对软件功能加以形象的说明。
##### 3.1.1 数据流图：
顶层数据流图：
![顶层数据流图](https://images.gitee.com/uploads/images/2018/1208/140401_d8733703_2313479.png "顶层数据流图.png")

0层数据流图：
![0层数据流图](https://images.gitee.com/uploads/images/2018/1208/140326_bd639ca5_2313479.png "0层数据流图.png")

1层数据流：
![1层数据流图](https://images.gitee.com/uploads/images/2018/1208/140514_e8e29afd_2313479.png "1层数据流图.png")
 
##### 3.1.2 实体-关系图
 
 ![实体关系图1](https://images.gitee.com/uploads/images/2018/1208/140557_4cd7b434_2313479.png "实体关系图.png")
 ![实体关系图2](https://images.gitee.com/uploads/images/2018/1208/140607_99c2e9cb_2313479.png "实体关系图2.png")
 ![实体关系图3](https://images.gitee.com/uploads/images/2018/1208/140613_3a9972b1_2313479.png "实体关系图3.png")
 ![实体关系图4](https://images.gitee.com/uploads/images/2018/1208/140624_09eeb50b_2313479.png "实体关系图4.png")

##### 3.1.3 流程图
![流程图](https://images.gitee.com/uploads/images/2018/1208/140721_b719830c_2313479.png "流程图.png")
 

流程图中的事件阐述：

###### 事件名称	游戏模式选择
* 事件编号	1
* 权限控制	电脑用户
* 具体过程	用户登录游戏，通过按键选择游戏模式，分为单人游戏和多人游戏两种。
* 后置条件	成功进入游戏或失败

###### 事件名称	竞选总督
* 事件编号	2
* 权限控制	玩家
* 具体过程	通过四位角色轮流输入金币价格竞选总督，金币不可超过手头上限。总督资格价高者得。
* 后置条件	竞选成功或者失败

###### 事件名称	运货前总督操作部分
* 事件编号	3
* 权限控制	总督玩家
* 具体过程	总督花按10金币与当前价格的较大值购买股票，选择装船货物，并决定起始位置。总督有九个前进点，可自由操控货船的放置位置，但所有位置值之和加起来必须为9，且每船位置值不超过5。
* 后置条件	无

###### 事件名称	放置随从
* 事件编号	4
* 权限控制	所有玩家
* 具体过程	从总督开始，按一定的玩家顺序放置随从。随从可以都成为船员、码头工人、修理人员（以上三种职业获利方式相同，在后面统称为一般随从），领航员，海盗，保险公司。除保险公司，放置随从都需要支付一定金额。而若选择保险公司，则立即获得10枚金币，但修理厂员工的费用需要保险公司出。
* 后置条件	无

###### 事件名称	掷骰子
* 事件编号	5
* 权限控制	软件自主操控
* 具体过程	游戏投3个骰子，对应三条货船。骰子结果对应货船前进步数。
* 后置条件	无

###### 事件名称	船进港（普通）
* 事件编号	6 
* 权限控制	软件自主操控 
* 具体过程	船在驶过13格的时候自动入港，若没有海盗时，第三轮投骰子后在第13格也自动入港。
* 后置条件	无

###### 事件名称	领航员操作
* 事件编号	7
* 权限控制	有随从担任领航员的玩家
* 具体过程	大领航员有2点操作点、小领航员有1点操作点，每个操作点能让一条船前进或后退1格。在操作时，小领航员先操作，大领航员后操作。
* 后置条件	无

###### 事件名称	海盗登船
* 事件编号	8
* 权限控制	有随从成为海盗的玩家
* 具体过程	第二轮刚好有船到达第13格时，若此时恰好有海盗，则海盗可以选择替换船上一名船员，原船员自动消失。
第三轮刚好有船到达13格时，若此时有海盗，则海盗可以将全体船员赶下船，并且自主决定船是驶向港口还是修理厂。
如果不止一条船恰到13，每个海盗只能选择一条船，海盗船长先选。小海盗不能把海盗船长扔下船。
* 后置条件	无

###### 事件名称	一般随从盈利
* 事件编号	9
* 权限控制	软件自行操控
*具体过程	对于入港口的船员，船员平分船上的盈利；对于去往修理厂的船员，没有利润；对于码头员工，获得码头处标明的对应奖励；对于修理员工，获得修理厂处标明的对应奖励。
* 后置条件	无

###### 事件名称	股票上涨
* 事件编号	10
* 权限控制	软件自行操控
* 具体过程	对于入港口的船，其上货物对应的股票上涨一级。
* 后置条件	无

###### 事件名称	游戏结束
* 事件编号	11
* 权限控制	软件自行操控
* 具体过程	若有一支股票上升至30金币，游戏结束。
* 后置条件	无

###### 事件名称	费用不足（隐藏事件）
* 事件编号	12
* 权限控制	所有玩家
* 具体过程	如果玩家没金币放置随从，则可以用股票抵押10元，结账时回返15元。
* 后置条件	无

###### 事件名称	结算
* 事件编号	13
* 权限控制	软件自行操控
* 具体过程	浮动的数值最终固定，显示玩家最终获利与排名，并且获得相应奖励。
* 后置条件	无
	
###### 事件名称	数据传输（多人模式）
* 事件编号	14
* 权限控制	服务器
* 具体过程	将数据传入服务器，并且同步传输到同一局的其他用户终端。由于可能有多位玩家，因此采用并行的方式，处于对数据的保护性以及游戏的顺序性考量，采用死锁的方式控制线程。
* 后置条件	无

###### 事件名称	用户管理
* 事件编号	15
* 权限控制	服务器
* 具体过程	服务器监听并在用户表中记录登录的节点信息，重复向节点发送消息以确定节点的活跃情况。根据游戏是否结束实现对用户数据的增删。
* 后置条件	无

###### 软件支持的终端数：百级
###### 软件支持的并行操作的用户数：百级

#### 3.2    对性能的规定
##### 3.2.1    精度 
　　要求对用户的文本输入错误进行处理。
###### 3.2.2    时间特性要求 
由于本软件为轻量级软件，而且供娱乐使用，而且希望模拟真实场景体验，因而规定时间特性要求，在网络带宽良好的情况下：
　　a．响应时间：毫秒级
　　b．更新处理时间；毫秒级
　　c．数据的转换和传送时间；毫秒级
　　d．电脑AI反应时间：秒级
###### 3.2.3    灵活性 
　　a．精度和有效时限的变化：在毫秒级的实现
　　b．计划的变化或改进：可能会涉及不同操作系统上的开发，取决于开发进度

#### 3.3    输入输出要求
输入数据主要为整形数据和鼠标的位置信息，需要对位置信息进行阈值处理。
图形界面主要包括五个层次：
1.	登录界面：背景图、相应的玩家盈利信息和、“单人游戏”、“多人游戏”、“历史记录”、“成就”、“商城”五大按键。
2.	“单人游戏”、“多人游戏”：马尼拉桌游背景图、可移动船只、船员、四位玩家、道具面板、资金输入面板、船员放置位置。游戏完成若达成成就自动弹出提示信息。
3.	 “历史记录”：往期游戏数据面板和个人评价等。
4.	“成就”：完成任务点亮图标。
5.	“商城”：人物形象、新的货物等，玩游戏获得资源，资源用于在商城购买。

#### 3.4    数据管理能力要求 
服务器的数据管理需求：实现局域网内百级用户数据的管理。
客户端的数据管理需求：实现对于历史游戏结果的保存管理，可达百次级别。
#### 3.5    故障处理要求
网络故障：断网或者服务器出现故障：报错网络环境不可用，无法完成软件功能。
用户错误：通过返回系统默认值进行规避，并且弹窗提示正确输入。
软件硬件故障：操作系统崩溃或硬件突然出现故障。删除现有记录，下次登录重开新局。
其它故障：提示错误信息。
## 4	运行环境规定 
#### 4.1    设备 
　　a．处理器型号：x86或x86-64处理器，性能高于Intel(R) Core(TM)i5-5200U,需要128MB或以上可用内存。
　　b．需要150M可用外存容量。
#### 4.2    支持软件 
服务器端：python语言脚本及框架，mysql数据库，Windows操作系统
客户端：python编写的程序，Windows操作系统
#### 创建：DQ&ZRQ
#### 最后一次修改：2018_11_27